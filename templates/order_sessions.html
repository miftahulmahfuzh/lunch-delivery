<!-- templates/order_sessions.html -->
{{define "content"}}
<div class="container">
    <div class="nav">
        <a href="/admin/">Dashboard</a>
        <a href="/admin/menu">Menu Items</a>
        <a href="/admin/companies">Companies</a>
        <a href="/admin/daily-menu">Daily Menu</a>
        <a href="/admin/sessions">Order Sessions</a>
    </div>

    <div class="card">
        <h2>Create Order Session</h2>

        <form method="POST" action="/admin/sessions">
            <div class="form-group">
                <label>Date:</label>
                <input type="date" name="date" value="{{.date}}" required>
            </div>
            <div class="form-group">
                <label>Company:</label>
                <select name="company_id" required>
                    <option value="">Select Company</option>
                    {{range .companies}}
                    <option value="{{.ID}}">{{.Name}}</option>
                    {{end}}
                </select>
            </div>
            <button type="submit" class="btn btn-success">Create Order Session</button>
        </form>
    </div>

    <div class="card">
        <h3>Today's Order Sessions</h3>
        {{if .sessions}}
            <table class="table">
                <thead>
                    <tr>
                        <th>Company</th>
                        <th>Status</th>
                        <th>Created</th>
                        <th>Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {{range .sessions}}
                    <tr>
                        <td>Company ID: {{.CompanyID}}</td>
                        <td><span class="status status-{{.Status | lower}}">{{.Status}}</span></td>
                        <td>{{.CreatedAt.Format "15:04"}}</td>
                        <td>
                            <a href="/admin/sessions/{{.ID}}/orders" class="btn">View Orders</a>
                            {{if eq .Status "OPEN"}}
                                <button onclick="closeSession({{.ID}})" class="btn btn-danger">Close</button>
                            {{end}}
                        </td>
                    </tr>
                    {{end}}
                </tbody>
            </table>
        {{else}}
            <p>No order sessions created for today.</p>
        {{end}}
    </div>
</div>

<script>
function closeSession(sessionId) {
    if (confirm('Close orders for this session?')) {
        fetch('/admin/sessions/' + sessionId + '/close', {method: 'POST'})
        .then(response => response.json())
        .then(data => {
            if (data.success) {
                location.reload();
            } else {
                alert('Error closing session');
            }
        });
    }
}
</script>
{{end}}
